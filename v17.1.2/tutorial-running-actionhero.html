<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>Tutorial: running-actionhero - ActionHero Documentation</title>
    
    <meta name="description" content="Documentation for the ActionHero.js Node.js framework" />
    
        <meta name="keywords" content="ActionHero Node Framework Docs Documentation" />
        <meta name="keyword" content="ActionHero Node Framework Docs Documentation" />
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://actionherojs.com" target="_blank" class="menu-item" id="website_link" >Main Website</a></h2><h2><a href="https://slack.actionherojs.com" target="_blank" class="menu-item" id="forum_link" >Slack</a></h2><h3>Tutorials</h3><ul><li><a href="tutorial-action-cluster.html">action-cluster</a></li><li><a href="tutorial-actions.html">actions</a></li><li><a href="tutorial-cli.html">cli</a></li><li><a href="tutorial-config.html">config</a></li><li><a href="tutorial-development-mode.html">development-mode</a></li><li><a href="tutorial-file-server.html">file-server</a></li><li><a href="tutorial-initializers.html">initializers</a></li><li><a href="tutorial-localization.html">localization</a></li><li><a href="tutorial-logging.html">logging</a></li><li><a href="tutorial-middleware.html">middleware</a></li><li><a href="tutorial-plugins.html">plugins</a></li><li><a href="tutorial-production-notes.html">production-notes</a></li><li><a href="tutorial-running-actionhero.html">running-actionhero</a></li><li><a href="tutorial-servers.html">servers</a></li><li><a href="tutorial-socket.html">socket</a></li><li><a href="tutorial-tasks.html">tasks</a></li><li><a href="tutorial-testing.html">testing</a></li><li><a href="tutorial-upgrade-path.html">upgrade-path</a></li><li><a href="tutorial-utils.html">utils</a></li><li><a href="tutorial-web.html">web</a></li><li><a href="tutorial-websocket.html">websocket</a></li></ul><h3>Namespaces</h3><ul><li><a href="api.actions.html">actions</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.actions.html#.addMiddleware">addMiddleware</a></li></ul></li><li><a href="api.cache.html">cache</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.cache.html#.clear">clear</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.destroy">destroy</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.dumpRead">dumpRead</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.dumpWrite">dumpWrite</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.keys">keys</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.listLength">listLength</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.load">load</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.lock">lock</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.locks">locks</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.pop">pop</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.push">push</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.save">save</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.size">size</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.unlock">unlock</a></li></ul></li><li><a href="api.chatRoom.html">chatRoom</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.chatRoom.html#.add">add</a></li><li data-type='method' style='display: none;'><a href="api.chatRoom.html#.addMember">addMember</a></li><li data-type='method' style='display: none;'><a href="api.chatRoom.html#.addMiddleware">addMiddleware</a></li><li data-type='method' style='display: none;'><a href="api.chatRoom.html#.broadcast">broadcast</a></li><li data-type='method' style='display: none;'><a href="api.chatRoom.html#.destroy">destroy</a></li><li data-type='method' style='display: none;'><a href="api.chatRoom.html#.exists">exists</a></li><li data-type='method' style='display: none;'><a href="api.chatRoom.html#.generateMemberDetails">generateMemberDetails</a></li><li data-type='method' style='display: none;'><a href="api.chatRoom.html#.list">list</a></li><li data-type='method' style='display: none;'><a href="api.chatRoom.html#.removeMember">removeMember</a></li><li data-type='method' style='display: none;'><a href="api.chatRoom.html#.roomStatus">roomStatus</a></li><li data-type='method' style='display: none;'><a href="api.chatRoom.html#.sanitizeMemberDetails">sanitizeMemberDetails</a></li></ul></li><li><a href="api.config.html">config</a></li><li><a href="api.connections.html">connections</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.connections.html#.addMiddleware">addMiddleware</a></li><li data-type='method' style='display: none;'><a href="api.connections.html#.apply">apply</a></li></ul></li><li><a href="api.documentation.html">documentation</a></li><li><a href="api.exceptions.html">exceptions</a></li><li><a href="api.i18n.html">i18n</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.i18n.html#.localize">localize</a></li></ul></li><li><a href="api.id.html">id</a></li><li><a href="api.params.html">params</a></li><li><a href="api.pids.html">pids</a></li><li><a href="api.redis.html">redis</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.redis.html#.doCluster">doCluster</a></li></ul></li><li><a href="api.resque.html">resque</a></li><li><a href="api.routes.html">routes</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.routes.html#.registerRoute">registerRoute</a></li></ul></li><li><a href="api.servers.html">servers</a></li><li><a href="api.specHelper.html">specHelper</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.specHelper.html#.connection">connection</a></li><li data-type='method' style='display: none;'><a href="api.specHelper.html#.getStaticFile">getStaticFile</a></li><li data-type='method' style='display: none;'><a href="api.specHelper.html#.runAction">runAction</a></li><li data-type='method' style='display: none;'><a href="api.specHelper.html#.runFullTask">runFullTask</a></li><li data-type='method' style='display: none;'><a href="api.specHelper.html#.runTask">runTask</a></li></ul></li><li><a href="api.staticFile.html">staticFile</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.staticFile.html#.get">get</a></li></ul></li><li><a href="api.tasks.html">tasks</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.tasks.html#.allDelayed">allDelayed</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.allWorkingOn">allWorkingOn</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.cleanOldWorkers">cleanOldWorkers</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.del">del</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.delayedAt">delayedAt</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.delDelayed">delDelayed</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.delLock">delLock</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.delQueue">delQueue</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.details">details</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.enqueue">enqueue</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.enqueueAllRecurrentJobs">enqueueAllRecurrentJobs</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.enqueueAt">enqueueAt</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.enqueueIn">enqueueIn</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.enqueueRecurrentJob">enqueueRecurrentJob</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.failed">failed</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.failedCount">failedCount</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.locks">locks</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.queued">queued</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.removeFailed">removeFailed</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.retryAndRemoveFailed">retryAndRemoveFailed</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.scheduledAt">scheduledAt</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.stats">stats</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.stopRecurrentJob">stopRecurrentJob</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.timestamps">timestamps</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.workers">workers</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.workingOn">workingOn</a></li></ul></li><li><a href="api.utils.html">utils</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.utils.html#.arrayUniqueify">arrayUniqueify</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.collapseObjectToArray">collapseObjectToArray</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.createDirSafely">createDirSafely</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.createFileSafely">createFileSafely</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.createLinkfileSafely">createLinkfileSafely</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.createSymlinkSafely">createSymlinkSafely</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.dirExists">dirExists</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.eventLoopDelay">eventLoopDelay</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.fileExists">fileExists</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.filterObjectForLogging">filterObjectForLogging</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.getExternalIPAddress">getExternalIPAddress</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.hashMerge">hashMerge</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.parseCookies">parseCookies</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.parseIPv6URI">parseIPv6URI</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.removeLinkfileSafely">removeLinkfileSafely</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.sortGlobalMiddleware">sortGlobalMiddleware</a></li></ul></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    
    <h1 class="page-title">Tutorial: running-actionhero</h1>
    

    <section>

<header>
    

    <h2>running-actionhero</h2>
</header>

<article>
    <h2>The ActionHero Binary</h2><pre class="prettyprint source lang-bash"><code>ActionHero - A multi-transport node.js API Server with integrated cluster capabilities and delayed tasks

Binary options:

* actions list
* console
* generate
* generate action
* generate cli
* generate initializer
* generate server
* generate task
* help
* link
* start
* start cluster
* task enqueue
* unlink
* version

Descriptions:

* actions list
  description: I will list the actions defined on this server

* console
  description: start an interactive REPL session with the api object in-scope

* generate
  description: will prepare an empty directory with a template ActionHero project

* generate action
  description: generate a new action
  example: actionhero generate action --name=[name] --description=[description]
  inputs:
    [name]
    [description]
      default: an actionhero action

* generate cli
  description: generate a new cli command
  example: actionhero generate cli --name=[name]
  inputs:
    [name]
    [description] (optional)
      default: an actionhero cli command
    [example] (optional)
      default: actionhero command --option=yes

* generate initializer
  description: generate a new initializer
  example: actionhero generate initializer --name=[name] --loadPriority=[p] --startPriority=[p] --stopPriority=[p]
  inputs:
    [name]
    [loadPriority]
      default: 1000
    [startPriority]
      default: 1000
    [stopPriority]
      default: 1000

* generate server
  description: generate a new server
  example: actionhero generate server --name=[name]
  inputs:
    [name]

* generate task
  description: generate a new task
  example: actionhero generate task --name=[name] --description=[description] --scope=[scope] --frequency=[frequency]
  inputs:
    [name]
    [queue]
    [description]
      default: an actionhero task
    [frequency]

* help
  description: get actonhero CLI help; will display this document

* link
  description: link a plugin to this actionhero project
  example: actionhero link --name=[pluginName] --overwriteConfig=[overwriteConfig]
  inputs:
    [name]
    [overwriteConfig] (optional)

* start
  description: start this ActionHero server
  example: actionhero start --config=[/path/to/config] --title=[processTitle] --daemon
  inputs:
    [config] (optional)
      note: path to config.js, defaults to &quot;process.cwd() + '/' + config.js&quot;. You can also use ENV[ACTIONHERO_CONFIG]
    [title] (optional)
      note: process title to use for ActionHeros ID, ps, log, and pidFile defaults. Must be unique for each member of the cluster. You can also use ENV[ACTIONHERO_TITLE]. Process renaming does not work on OSX/Windows
    [daemon] (optional)
      note: to fork and run as a new background process defaults to false

* start cluster
  description: start an actionhero cluster
  example: actionhero start cluster --workers=[numWorkers] --workerTitlePrefix=[title] --daemon
  inputs:
    [workers]
      note: number of workers (defaults to # CPUs)
      default: 8
    [title] (optional)
      note: worker title prefix (default 'actionhero-worker-') set \`--workerTitlePrefix=hostname\`, your app.id would be like \`your_host_name-#\`
    [workerTitlePrefix]
      default: actionhero-worker-
    [daemon] (optional)
      note: to fork and run as a new background process defaults to false
    [silent] (optional)

* task enqueue
  description: enqueue a defined task into your actionhero cluster
  example: actionhero task enqueue --name=[taskName] --args=[JSON-formatted args]
  inputs:
    [name]
    [args] (optional)
    [params] (optional)

* unlink
  description: unlink a plugin from this actionhero project
  example: actionhero unlink --name=[pluginName]
  inputs:
    [name]

* version
  description: return the ActionHero version within this project</code></pre><p>The suggested method to run your ActionHero server is to use the included <code>./node_modules/.bin/actionhero</code> binary. Note that there is no <code>main.js</code> or specific start script your project needs. ActionHero handles this for you. Your ActionHero project simply needs to follow the proper directory conventions and it will be bootable.</p>
<h2>Linking the ActionHero Binary</h2><ul>
<li>If you installed ActionHero globally (<code>npm install actionhero -g</code>) you should have the <code>actionhero</code> binary available to you within your shell at all times.</li>
<li>Otherwise, you can reference the binary from either <code>./node_modules/.bin/actionhero</code> or <code>./node_modules/actionhero/bin/actionhero</code>.</li>
<li>If you installed ActionHero locally, you can add a reference to your path (OSX and Linux): <code>export PATH=$PATH:node_modules/.bin</code> to be able to use simpler commands, IE <code>actionhero start</code>. On windows this can be done by running <code>set PATH=%PATH%;%cd%\node_modules\.bin</code> at command prompt (not powershell).</li>
</ul>
<h2>Environments and Config</h2><p>By default, ActionHero will use the settings found in the <code>exports.default</code> blocks in <code>/config/</code>. However, you can set environment-specfic overrides or changes. ActionHero inspects <code>process.env.NODE_ENV</code> to load up runtime configuration overrides from <code>{</code>exports.#{env}<code>}</code> blocks in your configuration files. This is the recommended way to have separate settings for staging and production.</p>
<p>The load order of configs is:</p>
<ul>
<li>default values in <code>/config</code></li>
<li>environment-specific values in <code>/config</code></li>
<li>options passed in to boot with <code>{</code>actionhero.start({configChanges: configChanges}, callback)<code>}</code></li>
</ul>
<pre class="prettyprint source lang-js"><code>// from ./config/namespace.js
exports['default'] = {
  namespace: function (api) {
    return {
      enabled: true,
      safe: false
    }
  }
}

exports.production = {
  namespace: function (api) {
    return {
      safe: true
    }
  }
}</code></pre><p>In the example above, we are defining <code>api.config.namespace.enabled</code> and <code>api.config.namespace.safe</code>. In all environments (NODE_ENV) <code>api.config.namespace.enabled = true</code> Only in production would <code>api.config.namespace.safe = true</code>, it is <code>false</code> everywhere else.</p>
<h2>Programatic Use of ActionHero</h2><pre class="prettyprint source lang-js"><code>var actionheroPrototype = require(&quot;actionhero&quot;);
var actionhero = new actionheroPrototype();

var timer = 5000;
actionhero.start(params, function(error, api){

  api.log(&quot; >> Boot Successful!&quot;);
  setTimeout(function(){

    api.log(&quot; >> restarting server...&quot;);
    actionhero.restart(function(error, api){

      api.log(&quot; >> Restarted!&quot;);
      setTimeout(function(){

        api.log(&quot; >> stopping server...&quot;);
        actionhero.stop(function(error, api){

          api.log(&quot; >> Stopped!&quot;);
          process.exit();

        });
      }, timer);
    })
  }, timer);
});</code></pre><p>While <strong>NOT</strong> encouraged, you can always instantiate an ActionHero server yourself. Perhaps you wish to combine ActionHero with an existing project. Here is how! Take note that using these methods will not work for actionCluster, and only a single instance will be started within your project.</p>
<p>Feel free to look at the source of <code>./node_modules/actionhero/bin/include/start</code> to see how the main ActionHero server is implemented for more information.</p>
<p>You can programmatically control an ActionHero server with <code>actionhero.start(params, callback)</code>, <code>actionhero.stop(callback)</code> and <code>actionhero.restart(callback)</code></p>
<p>From within ActionHero itself (actions, initilizers, etc), you can use <code>api.commands.start</code>, <code>api.commands.stop</code>, and <code>api.commands.restart</code> to control the server.</p>
<h2>Signals</h2><pre class="prettyprint source lang-bash"><code>> ./node_modules/.bin/actionhero start cluster --workers=2
info: actionhero >> start cluster
notice:  - STARTING CLUSTER -
notice: pid: 41382
info: starting worker #1
info: worker 41383 (#1) has spawned
info: Worker #1 [41383]: starting
info: Worker #1 [41383]: started
info: starting worker #2
info: worker 41384 (#2) has spawned
info: Worker #2 [41384]: starting
info: Worker #2 [41384]: started

# A new terminal
kill -s TTIN \`cat pids/cluster_pidfile\`

info: worker 41632 (#3) has spawned
info: Worker #3 [41632]: starting
info: Worker #3 [41632]: started

# A new terminal
kill -s KILL \`cat pids/cluster_pidfile\`

warning: Cluster manager quitting
info: Stopping each worker...
info: Worker #1 [41901]: stopping
info: Worker #2 [41904]: stopping
info: Worker #3 [41906]: stopping
info: Worker #3 [41906]: stopped
info: Worker #2 [41904]: stopped
info: Worker #1 [41901]: stopped
alert: worker 41901 (#1) has exited
alert: worker 41904 (#2) has exited
alert: worker 41906 (#3) has exited
info: all workers gone
notice: cluster complete, Bye!</code></pre><p>ActionHero is intended to be run on <code>*nix</code> operating systems. The <code>start</code> and <code>start cluster</code> commands provide support for signaling. (There is limited support for some of these commands in windows).</p>
<p><strong>actionhero start</strong></p>
<ul>
<li><code>kill</code> / <code>term</code> / <code>int</code> : Process will attempt to &quot;gracefully&quot; shut down. That is, the worker will close all server connections (possibly sending a shutdown message to clients, depending on server type), stop all task workers, and eventually shut down. This action may take some time to fully complete.</li>
<li><code>USR2</code>: Process will restart itself. The process will preform the &quot;graceful shutdown&quot; above, and they restart.</li>
</ul>
<p><strong>actionhero start cluster</strong></p>
<p>All signals should be sent to the cluster master process. You can still signal the termination of a worker, but the cluster manager will start a new one in its place.</p>
<ul>
<li><code>kill</code> / <code>term</code> / <code>int</code>: Will signal the master to &quot;gracefully terminate&quot; all workers. Master will terminate once all workers have completed</li>
<li><code>HUP</code> : Restart all workers.</li>
<li><code>USR2</code> : &quot;Hot reload&quot;. Worker will kill off existing workers one-by-one, and start a new worker in their place. This is used for 0-downtime restarts. Keep in mind that for a short while, your server will be running both old and new code while the workers are rolling.</li>
<li><code>TTOU</code>: remove one worker</li>
<li><code>TTIN</code>: add one worker</li>
</ul>
<h2>Shutting Down</h2><p>When using <code>actionhero start</code> or <code>actionhero start cluster</code>, when you signal ActionHero to stop via the signals above (or from within your running application via <code>api.commands.stop()</code>), actionhero will attempt to gracefully shutdown. This will include running any initializer's <code>stop()</code> method. This will close any open servers, and attempt to allow any running tasks to complete.</p>
<p>Because things sometimes go wrong, <code>actionhero start</code> and <code>actionhero start cluster</code> also have a &quot;emergency stop&quot; timeout. This defaults to 30 seconds, and is configurable via the <code>ACTIONHERO_SHUTDOWN_TIMEOUT</code> environment variable. Be sure that your tasks and actions can complete within that window, or else raise that shutdown limit.</p>
<h2>Windows Specific Notes</h2><ul>
<li>Sometimes ActionHero may require a git-based module (rather than a NPM module). You will need to have git installed. Depending on how you installed git, it may not be available to the node shell. Be sure to have also installed references to git. You can also run node/npm install from the git shell.*   Sometimes, npm will not install the actionhero binary @ <code>/node_modules/.bin/actionhero</code>, but rather it will attempt to create a windows executable and wrapper. You can launch ActionHero directly with <code>./node_modules/actionhero/bin/actionhero</code></li>
</ul>
</article>

</section>

    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/jquery-3.1.1.min.js"></script>


<script src="scripts/collapse.js"></script>



    <script src="scripts/logo.js"></script>
    
    <script src="scripts/style.js"></script>
    
    <script src="scripts/VERSIONS.js"></script>
    
    <script src="scripts/version-navigation.js"></script>
    
    <script src="scripts/google-analytics.js"></script>
    
</body>
</html>