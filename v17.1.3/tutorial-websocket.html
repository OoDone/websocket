<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>Tutorial: websocket - ActionHero Documentation</title>
    
    <meta name="description" content="Documentation for the ActionHero.js Node.js framework" />
    
        <meta name="keywords" content="ActionHero Node Framework Docs Documentation" />
        <meta name="keyword" content="ActionHero Node Framework Docs Documentation" />
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://actionherojs.com" target="_blank" class="menu-item" id="website_link" >Main Website</a></h2><h2><a href="https://slack.actionherojs.com" target="_blank" class="menu-item" id="forum_link" >Slack</a></h2><h3>Tutorials</h3><ul><li><a href="tutorial-action-cluster.html">action-cluster</a></li><li><a href="tutorial-actions.html">actions</a></li><li><a href="tutorial-cli.html">cli</a></li><li><a href="tutorial-config.html">config</a></li><li><a href="tutorial-development-mode.html">development-mode</a></li><li><a href="tutorial-file-server.html">file-server</a></li><li><a href="tutorial-initializers.html">initializers</a></li><li><a href="tutorial-localization.html">localization</a></li><li><a href="tutorial-logging.html">logging</a></li><li><a href="tutorial-middleware.html">middleware</a></li><li><a href="tutorial-plugins.html">plugins</a></li><li><a href="tutorial-production-notes.html">production-notes</a></li><li><a href="tutorial-running-actionhero.html">running-actionhero</a></li><li><a href="tutorial-servers.html">servers</a></li><li><a href="tutorial-socket.html">socket</a></li><li><a href="tutorial-tasks.html">tasks</a></li><li><a href="tutorial-testing.html">testing</a></li><li><a href="tutorial-upgrade-path.html">upgrade-path</a></li><li><a href="tutorial-utils.html">utils</a></li><li><a href="tutorial-web.html">web</a></li><li><a href="tutorial-websocket.html">websocket</a></li></ul><h3>Namespaces</h3><ul><li><a href="api.actions.html">actions</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.actions.html#.addMiddleware">addMiddleware</a></li></ul></li><li><a href="api.cache.html">cache</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.cache.html#.clear">clear</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.destroy">destroy</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.dumpRead">dumpRead</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.dumpWrite">dumpWrite</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.keys">keys</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.listLength">listLength</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.load">load</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.lock">lock</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.locks">locks</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.pop">pop</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.push">push</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.save">save</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.size">size</a></li><li data-type='method' style='display: none;'><a href="api.cache.html#.unlock">unlock</a></li></ul></li><li><a href="api.chatRoom.html">chatRoom</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.chatRoom.html#.add">add</a></li><li data-type='method' style='display: none;'><a href="api.chatRoom.html#.addMember">addMember</a></li><li data-type='method' style='display: none;'><a href="api.chatRoom.html#.addMiddleware">addMiddleware</a></li><li data-type='method' style='display: none;'><a href="api.chatRoom.html#.broadcast">broadcast</a></li><li data-type='method' style='display: none;'><a href="api.chatRoom.html#.destroy">destroy</a></li><li data-type='method' style='display: none;'><a href="api.chatRoom.html#.exists">exists</a></li><li data-type='method' style='display: none;'><a href="api.chatRoom.html#.generateMemberDetails">generateMemberDetails</a></li><li data-type='method' style='display: none;'><a href="api.chatRoom.html#.list">list</a></li><li data-type='method' style='display: none;'><a href="api.chatRoom.html#.removeMember">removeMember</a></li><li data-type='method' style='display: none;'><a href="api.chatRoom.html#.roomStatus">roomStatus</a></li><li data-type='method' style='display: none;'><a href="api.chatRoom.html#.sanitizeMemberDetails">sanitizeMemberDetails</a></li></ul></li><li><a href="api.config.html">config</a></li><li><a href="api.connections.html">connections</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.connections.html#.addMiddleware">addMiddleware</a></li><li data-type='method' style='display: none;'><a href="api.connections.html#.apply">apply</a></li></ul></li><li><a href="api.documentation.html">documentation</a></li><li><a href="api.exceptions.html">exceptions</a></li><li><a href="api.i18n.html">i18n</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.i18n.html#.localize">localize</a></li></ul></li><li><a href="api.id.html">id</a></li><li><a href="api.params.html">params</a></li><li><a href="api.pids.html">pids</a></li><li><a href="api.redis.html">redis</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.redis.html#.doCluster">doCluster</a></li></ul></li><li><a href="api.resque.html">resque</a></li><li><a href="api.routes.html">routes</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.routes.html#.registerRoute">registerRoute</a></li></ul></li><li><a href="api.servers.html">servers</a></li><li><a href="api.specHelper.html">specHelper</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.specHelper.html#.connection">connection</a></li><li data-type='method' style='display: none;'><a href="api.specHelper.html#.getStaticFile">getStaticFile</a></li><li data-type='method' style='display: none;'><a href="api.specHelper.html#.runAction">runAction</a></li><li data-type='method' style='display: none;'><a href="api.specHelper.html#.runFullTask">runFullTask</a></li><li data-type='method' style='display: none;'><a href="api.specHelper.html#.runTask">runTask</a></li></ul></li><li><a href="api.staticFile.html">staticFile</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.staticFile.html#.get">get</a></li></ul></li><li><a href="api.tasks.html">tasks</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.tasks.html#.allDelayed">allDelayed</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.allWorkingOn">allWorkingOn</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.cleanOldWorkers">cleanOldWorkers</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.del">del</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.delayedAt">delayedAt</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.delDelayed">delDelayed</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.delLock">delLock</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.delQueue">delQueue</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.details">details</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.enqueue">enqueue</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.enqueueAllRecurrentJobs">enqueueAllRecurrentJobs</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.enqueueAt">enqueueAt</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.enqueueIn">enqueueIn</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.enqueueRecurrentJob">enqueueRecurrentJob</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.failed">failed</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.failedCount">failedCount</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.locks">locks</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.queued">queued</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.removeFailed">removeFailed</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.retryAndRemoveFailed">retryAndRemoveFailed</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.scheduledAt">scheduledAt</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.stats">stats</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.stopRecurrentJob">stopRecurrentJob</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.timestamps">timestamps</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.workers">workers</a></li><li data-type='method' style='display: none;'><a href="api.tasks.html#.workingOn">workingOn</a></li></ul></li><li><a href="api.utils.html">utils</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.utils.html#.arrayUniqueify">arrayUniqueify</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.collapseObjectToArray">collapseObjectToArray</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.createDirSafely">createDirSafely</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.createFileSafely">createFileSafely</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.createLinkfileSafely">createLinkfileSafely</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.createSymlinkSafely">createSymlinkSafely</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.dirExists">dirExists</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.eventLoopDelay">eventLoopDelay</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.fileExists">fileExists</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.filterObjectForLogging">filterObjectForLogging</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.getExternalIPAddress">getExternalIPAddress</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.hashMerge">hashMerge</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.parseCookies">parseCookies</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.parseIPv6URI">parseIPv6URI</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.removeLinkfileSafely">removeLinkfileSafely</a></li><li data-type='method' style='display: none;'><a href="api.utils.html#.sortGlobalMiddleware">sortGlobalMiddleware</a></li></ul></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    
    <h1 class="page-title">Tutorial: websocket</h1>
    

    <section>

<header>
    

    <h2>websocket</h2>
</header>

<article>
    <h2>Overview</h2><p>ActionHero uses <a href="https://github.com/primus/primus">Primus</a> for web sockets. The Primus project allows you to choose from many websocket backends, including <code>ws</code>, <code>engine.io</code>, <code>socket.io</code>, and more. Within ActionHero, web sockets are bound to the web server (either http or https).</p>
<p>ActionHero will generate the client-side javascript needed for you (based on the actionheroClient library, primus, and the underlying ws transport). This file is regenerated each time you boot the application.</p>
<h2>Connection Details</h2><pre class="prettyprint source lang-html"><code>// In the Browser...
&lt;script src=&quot;/public/javascript/actionheroClient.js&quot;>&lt;/script>

&lt;script>

  client = new ActionheroClient;

  client.on('connected',    function(){ console.log('connected!') })
  client.on('disconnected', function(){ console.log('disconnected :(') })

  client.on('error',        function(error){ console.log('error', error.stack) })
  client.on('reconnect',    function(){ console.log('reconnect') })
  client.on('reconnecting', function(){ console.log('reconnecting') })

  // this will log all messages send the client
  // client.on('message',      function(message){ console.log(message) })

  client.on('alert',        function(message){ alert(message) })
  client.on('api',          function(message){ alert(message) })

  client.on('welcome',      function(message){ appendMessage(message); })
  client.on('say',          function(message){ appendMessage(message); })

  client.connect(function(error, details){
    if(error != null){
      console.log(error);
    }else{
      client.roomAdd(&quot;defaultRoom&quot;);
      client.action('someAction', {key: 'k', value: 'v'}, function(error, data){
        // do stuff
      });
    }
  });

&lt;/script></code></pre><p><code>connection.type</code> for a webSocket client is &quot;webSocket&quot;. This type will not change regardless of if the client has fallen back to another protocol.</p>
<p>Data is always returned as JSON objects to the webSocket client.</p>
<p>An example web socket session might be the following:</p>
<p>You can also inspect <code>client.state</code> (‘connected', ‘disconnected', etc). The websocket client will attempt to re-connect automatically.</p>
<p>If you want to communicate with a websocket client outside of an action, you can call <code>connection.send(message)</code> on the server. In the client lib, the event message will be fired. So, <code>{</code>client.on('message, function(m){ ... })<code>}</code>. Be sure to add some descriptive content to the message you send from the sever (like perhaps <code>{</code>{&quot;type&quot;: 'message type'}<code>}</code>) so you can route message types on the client.</p>
<h2>Client Methods</h2><p>Methods which an ActionHero Client instance provider are:</p>
<h3><code>client.connect(callback)</code></h3><ul>
<li><code>callback</code> will contain (error, details)</li>
<li>details here is the same as the <code>detailsView</code> method</li>
</ul>
<h3><code>client.action(action, params, callback)</code></h3><ul>
<li><code>action</code> is a string, like &quot;login&quot;</li>
<li><code>params</code> is an object</li>
<li><code>callback</code> will be passed <code>response</code> (and you can inspect <code>response.error</code>)</li>
</ul>
<h3><code>client.say(room, message, callback)</code></h3><ul>
<li><code>message</code> is a string</li>
<li>may contain an <code>error</code></li>
<li>note that you have to first join a room with <code>roomAdd</code> to chat within it of recieve events</li>
</ul>
<h3><code>client.detailsView(callback)</code></h3><ul>
<li><code>callback</code> will be passed <code>error</code>, <code>response</code></li>
<li>the first response from detailsView will also always be saved to <code>client.details</code> for later inspection</li>
<li>may contain an <code>error</code></li>
</ul>
<h3><code>client.roomView(room, callback)</code></h3><ul>
<li>will return metadata about the room</li>
<li>may contain an <code>error</code></li>
</ul>
<h3><code>client.roomAdd(room, callback)</code></h3><ul>
<li><code>room</code> is a string</li>
<li>may contain an <code>error</code></li>
</ul>
<h3><code>client.roomLeave(room, callback)</code></h3><ul>
<li><code>room</code> is a string</li>
<li>may contain an <code>error</code></li>
</ul>
<h3><code>client.file(callback)</code></h3><ul>
<li>see below for details</li>
</ul>
<h3><code>client.disconnect()</code></h3><ul>
<li>instantly sever the connection to the server</li>
</ul>
<p>The contents of the <code>file</code> callback look like:</p>
<pre class="prettyprint source lang-js"><code>{
  content: &quot;&lt;h1>ActionHero&lt;/h1>\nI am a flat file being served to you via the API from ./public/simple.html&lt;br />&quot;,
  context: &quot;response&quot;,
  error: null,
  length: 101,
  messageCount: 3,
  mime: &quot;text/html&quot;
}</code></pre><h2>Client Events</h2><h3><code>{</code>client.on(‘connected', callback)<code>}</code></h3><ul>
<li>no event data</li>
</ul>
<h3><code>{</code>client.on(‘disconnected', callback)<code>}</code></h3><ul>
<li>no event data</li>
</ul>
<h3><code>{</code>client.on(‘error', (error) =&gt; { console.log(‘error', error.stack) })<code>}</code></h3><ul>
<li>this is fired when a general error is encountered (outside of an action or verb)</li>
<li>this may fire when a general server error occurs</li>
</ul>
<h3><code>{</code>client.on(‘reconnect', () =&gt; { console.log(‘reconnect') })<code>}</code></h3><ul>
<li>fired when client has reconnected</li>
<li>this will indicate that details, connection.id and other server-generated settings may have changed</li>
</ul>
<h3><code>{</code>client.on(‘reconnecting', callback })<code>}</code></h3><ul>
<li>client is attempting to reconnect to server</li>
</ul>
<h3><code>{</code>client.on(‘message', (message) =&gt; { console.log(message) })<code>}</code></h3><ul>
<li>this is VERY noisy, and is fired on all messages from the server, regardless of context or callback</li>
</ul>
<h3><code>{</code>client.on(‘alert', (message) =&gt; { alert(message) })<code>}</code></h3><ul>
<li>fired when message recieved from the server's context is specifically <code>alert</code></li>
</ul>
<h3><code>{</code>client.on(‘api', (message) =&gt; { alert(message) })<code>}</code></h3><ul>
<li>fired when message recieved from the server's context is unknown or from the server</li>
</ul>
<h3><code>{</code>client.on(‘welcome', (message) =&gt; { console.log(message); })<code>}</code></h3><ul>
<li>server's welcome message</li>
</ul>
<h3><code>{</code>client.on(‘say', (message) =&gt; { console.log(message); })<code>}</code></h3><ul>
<li>fired on all say messages from other clients in all rooms</li>
<li>message.room can be inspected</li>
</ul>
<h2>Linking WebSockets to Web Clients</h2><p>ActionHero provides <code>connection.fingerprint</code> where available to help you link websocket connections to related web connections. While every connection will always have a unique <code>connection.id</code>, we attempt to build <code>connection.fingerprint</code> by checking the headers the websocket connection began with. If the cookie defined by <code>api.config.servers.web.fingerprint.cookieKey</code> is present, we will store its value on the websocket connection.</p>
<p>You can read more about using a value like <code>connection.fingerprint</code> in an <a href="/docs/core/middleware">authentication middleware</a> or using it as a key for session information.</p>
<h2>Config Options</h2><pre class="prettyprint source lang-js"><code>exports['default'] = {
  servers: {
    websocket: function (api) {
      return {
        enabled: true,
        // you can pass a FQDN (string) here or 'window.location.origin'
        clientUrl: 'window.location.origin',
        // Directory to render client-side JS.
        // Path should start with &quot;/&quot; and will be built starting from api.config..general.paths.public
        clientJsPath: 'javascript/',
        // the name of the client-side JS file to render.  Both \`.js\` and \`.min.js\` versions will be created
        // do not include the file exension
        // set to \`undefined\` to not render the client-side JS on boot
        clientJsName: 'actionheroClient',
        // should the server signal clients to not reconnect when the server is shutdown/reboot
        destroyClientsOnShutdown: false,

        // websocket Server Options:
        server: {
          // authorization: null,
          // pathname:      '/primus',
          // parser:        'JSON',
          // transformer:   'websockets',
          // plugin:        {},
          // timeout:       35000,
          // origins:       '*',
          // methods:       ['GET','HEAD','PUT','POST','DELETE','OPTIONS'],
          // credentials:   true,
          // maxAge:        '30 days',
          // exposed:       false,
        },

        // websocket Client Options:
        client: {
          apiPath: '/api' // the api base endpoint on your actionhero server
          // reconnect:        {},
          // timeout:          10000,
          // ping:             25000,
          // pong:             10000,
          // strategy:         &quot;online&quot;,
          // manual:           false,
          // websockets:       true,
          // network:          true,
          // transport:        {},
          // queueSize:        Infinity,
        }
      }
    }
  }
}</code></pre><p>You can create your client with options. Options for both the server and client are stored in <code>/config/servers/websocket.js</code>. Note there are 2 sections: <code>server</code> and <code>client</code>.</p>
</article>

</section>

    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/jquery-3.1.1.min.js"></script>


<script src="scripts/collapse.js"></script>



    <script src="scripts/logo.js"></script>
    
    <script src="scripts/style.js"></script>
    
    <script src="scripts/VERSIONS.js"></script>
    
    <script src="scripts/version-navigation.js"></script>
    
    <script src="scripts/google-analytics.js"></script>
    
</body>
</html>